# language: python
# os: linux
# python: 3.9
# os: linux-s390
# python: 3.9
arch:
  - amd64
  # - ppc64le
  - linux-s390x
  - arm64

# os: 

dist: focal
# addons:
#   apt:
#     packages:
#       - python3.9
#       - pip3

before_install:
  - sudo rm -rf /var/lib/apt/lists/* && sudo apt update && sudo apt upgrade -y --no-install-recommends
  - curl -fsSL https://get.docker.com -o get-docker.sh && sudo sh get-docker.sh
# script:
  - docker version
  # - docker buildx version
  # - docker buildx create --use --bootstrap
  # - docker buildx ls
  # - sudo apt clean && sudo apt update && sudo apt upgrade -y
  # - sudo apt install build-essential libncurses5-dev zlib1g-dev libnss3-dev libgdbm-dev libssl-dev libsqlite3-dev libffi-dev libreadline-dev curl libbz2-dev -y
  # - sudo add-apt-repository -y ppa:deadsnakes/ppa
  # - sudo apt update && sudo apt install -y python3.9 python3.9-dev python3.9-venv pip3
  # - python3 -m ensurepip --default-pip --user
  # - python3 -m pip install build

jobs:
  include:

    - stage: Build MultiArch AWX-Receptor
    # - os: linux-amd64
    #   python: 3.9
    # - os: linux-s390
    #   python: 3.9
    # - arch: arm64-graviton2
    #   os: linux
    #   python: 3.9
      before_script: 
        - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
        - export DEPLOY_TIMESTAMP=`date +'%Y%m%d-%H%M%S'`
        - export git_repo=$(echo $TRAVIS_REPO_SLUG |  awk -F"/" '{print tolower($2)}')
        - export TAG=`uname -i`
      script: 
        -  make container OFFICIAL_VERSION=yes TAG=${TAG} CONTAINERCMD=docker REPO=docker.io/$DOCKER_USERNAME/${git_repo} VERSION=v1.2.4 LATEST=yes
      after_script:
        - echo "Script completed on" DEPLOY_TIMESTAMP
    
    # - stage: Merge Manifests
